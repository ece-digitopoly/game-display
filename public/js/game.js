all_props = [
             {"name": "start_and_go", 
              "displayname": "PASSING GO!",
              "description": "Collect $200!"},
             {"name": "mediterrenean",
              "price": "$60",
              "color": "#db9c0a",
              "displayname":"MEDITERRANEAN AVE.",
              "rent": "$2",
              "house1": "$10",
              "house2": "$30",
              "house3": "$90",
              "house4": "$160",
              "hotel": "$250",
              "mortgage": "$30",
              "housecost": "$50",
              "posthotel": "$50"
             },
             {"name": "communitychest1",
             "displayname": "COMMUNITY CHEST"},
             {"name": "baltic",
              "price": "$60",
             "color": "#db9c0a",
             "displayname":"BALTIC AVE.",
             "rent": "$4",
             "house1": "$20",
             "house2": "$60",
             "house3": "$180",
             "house4": "$320",
             "hotel": "$450",
             "mortgage": "$30",
             "housecost": "$50",
             "posthotel": "$50"
             },
             {"name": "incometax", 
              "displayname": "INCOME TAX",
              "tax": "$200"},
             {"name": "readingrr", 
              "displayname": "READING RAILROAD",
              "price": "$200", 
              "mortage":"100"},      // 24
             {"name": "oriental",
             "color": "#5bf2f5",
             "displayname":"ORIENTAL AVE.",
             "rent": "$6",
             "house1": "$30",
             "house2": "$90",
             "house3": "$270",
             "house4": "$400",
             "hotel": "$550",
             "mortgage": "$50",
             "housecost": "$50",
             "posthotel": "$50"
             },
             {"name": "chance1",
             "displayname": "CHANCE"},
             {"name": "vermont",
              "price": "$100",
             "color": "#5bf2f5",
             "displayname":"VERMONT AVE.",
             "rent": "$6",
             "house1": "$30",
             "house2": "$90",
             "house3": "$270",
             "house4": "$400",
             "hotel": "$550",
             "mortgage": "$50",
             "housecost": "$50",
             "posthotel": "$50"
             },
             {"name": "connecticut",
              "price": "$100",
             "color": "#5bf2f5",
             "displayname":"CONNECTICUT AVE.",
             "rent": "$8",
             "house1": "$40",
             "house2": "$100",
             "house3": "$300",
             "house4": "$450",
             "hotel": "$600",
             "mortgage": "$60",
             "housecost": "$50",
             "posthotel": "$50"
             },
             {"name": "jail", "displayname": "PASSING THROUGH JAIL"},
             {"name": "stcharles",
              "price": "$120",
               "color": "#964bbf",
               "displayname":"ST. CHARLES PLACE",
               "rent": "$10",
               "house1": "$50",
               "house2": "$150",
               "house3": "$450",
               "house4": "$625",
               "hotel": "$750",
               "mortgage": "$70",
               "housecost": "$100",
               "posthotel": "$100"
              },
              {"name": "electricco",  // 23
              "price": "$140",
               "displayname":"ELECTRIC CO.",
               "mortgage": "75",
              },
              {"name": "statesave",
              "price": "$150",
               "color": "#964bbf",
               "displayname":"STATES AVE.",
               "rent": "$10",
               "house1": "$50",
               "house2": "$150",
               "house3": "$450",
               "house4": "$625",
               "hotel": "$750",
               "mortgage": "$70",
               "housecost": "$100",
               "posthotel": "$100"
              },
              {"name": "virginia",
              "price": "$160",
               "color": "#964bbf",
               "displayname":"VIRGINIA AVE.",
               "rent": "$12",
               "house1": "$60",
               "house2": "$180",
               "house3": "$500",
               "house4": "$700",
               "hotel": "$900",
               "mortgage": "$80",
               "housecost": "$100",
               "posthotel": "$100"
              },
              {"name": "pennsylvaniarr",
               "displayname": "PENNSYLVANIA RAILROAD",
               "price": "$200",
               "mortage":"100"},
              {"name": "stjames",
               "color": "#eb9e34",
               "displayname":"ST. JAMES PLACE",
               "rent": "$14",
               "house1": "$70",
               "house2": "$200",
               "house3": "$550",
               "house4": "$750",
               "hotel": "$950",
               "mortgage": "$90",
               "housecost": "$100",
               "posthotel": "$100"
              },
              {"name": "communitychest2", "displayname": "COMMUNITY CHEST"},
              {"name": "tennessee",
              "price": "$180",
               "color": "#eb9e34",
               "displayname":"TENNESSEE AVE.",
               "rent": "$14",
               "house1": "$70",
               "house2": "$200",
               "house3": "$550",
               "house4": "$750",
               "hotel": "$950",
               "mortgage": "$90",
               "housecost": "$100",
               "posthotel": "$100"
              },
              {"name": "newyork",
              "price": "$180",
               "color": "#eb9e34",
               "displayname":"NEW YORK AVE.",
               "rent": "$16",
               "house1": "$80",
               "house2": "$220",
               "house3": "$600",
               "house4": "$800",
               "hotel": "$1000",
               "mortgage": "$100",
               "housecost": "$100",
               "posthotel": "$100"
              },
              {"name": "freeparking", "displayname": "FREE PARKING"},
              {"name": "kentucky",
              "price": "$200",
               "color": "#f2322c",
               "displayname":"KENTUCKY AVE.",
               "rent": "$18",
               "house1": "$90",
               "house2": "$250",
               "house3": "$700",
               "house4": "$875",
               "hotel": "$1050",
               "mortgage": "$110",
               "housecost": "$150",
               "posthotel": "$150"
              },
              {"name": "chance2", "displayname": "CHANCE"},
              {"name": "indiana",
              "price": "$220",
               "color": "#f2322c",
               "displayname":"INDIANA AVE.",
               "rent": "$18",
               "house1": "$90",
               "house2": "$250",
               "house3": "$700",
               "house4": "$875",
               "hotel": "$1050",
               "mortgage": "$110",
               "housecost": "$150",
               "posthotel": "$150"
              },
              {"name": "illinois",
              "price": "$220",
               "color": "#f2322c",
               "displayname":"ILLINOIS AVE.",
               "rent": "$20",
               "house1": "$100",
               "house2": "$300",
               "house3": "$750",
               "house4": "$925",
               "hotel": "$1100",
               "mortgage": "$120",
               "housecost": "$150",
               "posthotel": "$150"
              },
              {"name": "borailroad",
               "displayname": "B&O RAILROAD",
               "price": "$240", 
               "mortage": "100"},     // 26
              {"name": "atlantic",
              "price": "$200",
               "color": "#fff769",
               "displayname":"ATLANTIC AVE.",
               "rent": "$22",
               "house1": "$110",
               "house2": "$330",
               "house3": "$800",
               "house4": "$975",
               "hotel": "$1150",
               "mortgage": "$130",
               "housecost": "$150",
               "posthotel": "$150"
              },
              {"name": "ventnor",
              "price": "$260",
              "color": "#fff769",
              "displayname":"VENTNOR AVE.",
              "rent": "$22",
              "house1": "$110",
              "house2": "$330",
              "house3": "$800",
              "house4": "$975",
              "hotel": "$1150",
              "mortgage": "$130",
              "housecost": "$150",
              "posthotel": "$150"
             },
             {"name": "waterworks",  // 22
              "price": "$150",
                    "displayname":"WATER WORKS",
                    "mortgage": "75",
             },
             {"name": "marvin",
              "price": "$280",
               "color": "#fff769",
               "displayname":"MARVIN GARDENS",
               "rent": "$24",
               "house1": "$120",
               "house2": "$360",
               "house3": "$850",
               "house4": "$1025",
               "hotel": "$1200",
               "mortgage": "$140",
               "housecost": "$150",
               "posthotel": "$150"
             },
             {"name": "gotojail", "displayname": "GO TO JAIL!"},
             {"name": "pacific",
              "price": "$300",
               "color": "#00b04f",
               "displayname":"PACIFIC AVE.",
               "rent": "$26",
               "house1": "$130",
               "house2": "$390",
               "house3": "$900",
               "house4": "$1100",
               "hotel": "$1275",
               "mortgage": "$150",
               "housecost": "$200",
               "posthotel": "$200"
              },
              {"name": "northcarolina",
              "price": "$300",
               "color": "#00b04f",
               "displayname":"NORTH CAROLINA AVE.",
               "rent": "$26",
               "house1": "$130",
               "house2": "$390",
               "house3": "$900",
               "house4": "$1100",
               "hotel": "$1275",
               "mortgage": "$150",
               "housecost": "$200",
               "posthotel": "$200"
              },
              {"name": "communitychest3", "displayname": "COMMUNITY CHEST"},
              {"name": "pennsylvania",
              "price": "$320",
               "color": "#00b04f",
               "displayname":"PENNSYLVANIA AVE.",
               "rent": "$28",
               "house1": "$150",
               "house2": "$450",
               "house3": "$1000",
               "house4": "$1200",
               "hotel": "$1400",
               "mortgage": "$160",
               "housecost": "$200",
               "posthotel": "$200"
              },
              {"name": "shortlinerailroad", 
               "displayname": "SHORT LINE RAILROAD", 
               "price": "$200", "mortage": "100"},    // 27
              {"name": "chance3", "displayname": "CHANCE"},
              {"name": "parkplace",
              "price": "$350",
               "color": "#024abf",
               "displayname":"PARK PLACE",
               "rent": "$35",
               "house1": "$175",
               "house2": "$500",
               "house3": "$1100",
               "house4": "$1300",
               "hotel": "$1500",
               "mortgage": "$175",
               "housecost": "$200",
               "posthotel": "$200"
              },
              {"name": "luxurytax", "displayname": "LUXURY TAX", "tax": "$75"},
              {"name": "boardwalk",
              "price": "$400",
               "color": "#024abf",
               "displayname":"BOARDWALK",
               "rent": "$50",
               "house1": "$200",
               "house2": "$600",
               "house3": "$1400",
               "house4": "$1700",
               "hotel": "$2000",
               "mortgage": "$200",
               "housecost": "$200",
               "posthotel": "$200"
              }]
                
railway = [
            ["Rent", 25],  //rent 
            ["Own 2 railroads", 50],  //own 2 rr's
            ["Own 3 railroads", 100], //own 3 rr's 
            ["Own 4 railroads", 200], //own 4 rr's 
            ["Mortage Value", 100], //mortgage
          ]

    chance =  [
                {description: "Advance to Go."},
                {description: "Advance to Illinois Ave. If you pass Go, collect $200."},
                {description: "Advance to St. Charles Place. If you pass Go, collect $200."},
                {description: "Advance token to nearest Utility. If unowned, you may buy it from the Bank. If owned, throw dice and pay owner a total 10 times the amount thrown."},
                {description: "Advance token to the nearest Railroad and pay owner twice the rental to which he/she  is otherwise entitled. If Railroad is unowned, you may buy it from the Bank."},
                {description: "Bank pays you dividend of $50. "},
                {description: "Go Back Three Spaces. "},
                {description: "Go to Jail. Go directly to Jail. Do not pass GO, do not collect $200. "},
                {description: "Make general repairs on all your property: For each house pay $25, For each hotel  $100."},
                {description: "Pay poor tax of $15."},
                {description: "Take a trip to Reading Railroad.  If you pass Go, collect $200. "},
                {description: "Take a walk on the Boardwalk. Advance token to Boardwalk. "},
                {description: "You have been elected Chairman of the Board. Pay each player $50. "},
                {description: "Your building loan matures. Receive $150."},
                {description: "You have won a crossword competition. Collect $100."}
            ]

commchest = [
                {description: "Advance to \"Go\". Collect $200."},
                {description: "Bank error in your favor. Collect $200. "},
                {description: "Doctor's fees. Pay $50. "},
                {description: "From sale of stock you get $50."},
                {description: "Go to Jail. Go directly to jail. Do not pass Go, Do not collect $200. "},
                {description: "Grand Opera Night. Collect $50 from every player for opening night seats. "},
                {description: "Holiday Fund matures. Receive $100. "},
                {description: "Income tax refund. Collect $20."},
                {description: "It is your birthday. Collect $10 from every player."},
                {description: "Life insurance matures â€“ Collect $100."},
                {description: "Hospital Fees. Pay $50."},
                {description: "School fees. Pay $50."},
                {description: "Receive $25 consultancy fee."},
                {description: "You are assessed for street repairs: Pay $40 per house and $115 per hotel you own."},
                {description: "You have won second prize in a beauty contest. Collect $10. "},
                {description: "You inherit $100."}
            ]

var DICE_ROLL = -1
var NEXT_POS = -1
var CCC_ID = -1
var CURRENT_POSITION = [0, 0, 0, 0]     // for four players
var CURRENT_PLAYER = 0                  // zero index - 0, 1, 2, 3
var BOARD_STATE = "INIT"

var ROLL_TEST = 9

var PLAYER_HOLDINGS = [
    [], // player 1
    [], // player 2
    [], // player 3
    []  // player 4
]

property_go         = 0
property_jail       = 10
property_gotojail   = 30
property_parking    = 20
property_taxes      = [4, 38]
property_community  = [2, 17, 33]
property_chance     = [7, 22, 36]
property_utility    = [12, 28]
property_ownable    = [1, 3, 5, 6, 8, 9, 11, 12, 13, 14, 15,
                       16, 18, 19, 21, 23, 24, 25, 26, 27,
                       28, 29, 31, 32, 34, 35, 37, 39]

$.fn.classList = function() {
    try {
        return this[0].className.split(/\s+/);
    }
    catch {
        return []
    }
};

// testing function
function continue_play(player) {
    $("#overlay").css ('opacity', 0)
    CURRENT_PLAYER = player

    player = player == 0 ? "ship" : 
             player == 1 ? "boot" :    
             player == 2 ? "car" : "dog"

    $("#dialog1").html ("It's the " + player + "'s turn!")
    $("#dialog2").html ("Roll the dice to move the piece.")
    console.log ($("#dialog1").html())

    $("#diedialog").css ('display', 'flex')
    $("#landed_unowned_dialog").css ('display', 'none')
    $("#overlay").css ('opacity', 1)
    console.log ($("#dialog1").html())
}

function init_board () {
    $("#diedialog").css ('display', 'flex')
    $("#landed_unowned_dialog").css ('display', 'none')
    $("#overlay").css ('opacity', 1)

    list = document.getElementsByClassName ("tile")
    arr = Array.prototype.slice.call(list)

    // Color tiles around by looking at property details
    arr.map (elm => {
        id = elm.id.replace ("tile_", "")
        property = all_props.filter (function (v, i, a) { if (v.name == id) return v })
        return property[0]
     }).forEach(element => {
        if (typeof element == "undefined")
            return
        id = "tile_" + element.name
        $("#" + id).css ('background-color', element.color || '#fff')
     });

    window.gameState = "GAME"
}

function gamePlayKeyHandler (uartjson) {
    // console.log (uartjson ['action'])
    // console.log (uartjson ['direction'])
    buttons = []
    for (var elm in $(".btn-dialog")) {
        if (!isNaN (elm)) {
            buttons.push ($(".btn-dialog") [parseInt (elm)])
        }
    }
    hover_index = buttons.indexOf (buttons.find (element => [...element.classList].includes ('btn-hover')))

    if (uartjson ['action'] == 'scroll' && uartjson ['direction'] == 'up') {
        switch (BOARD_STATE) {
            case "PLAYERWAIT":
                if (hover_index == 0) {
                    buttons [0].classList.replace ('btn-hover', 'btn')                   // Turn first button off
                    buttons [buttons.length - 1].classList.replace ('btn', 'btn-hover')  // Turn last button on
                }
                else {
                    buttons [hover_index].classList.replace ('btn-hover', 'btn')     // Turn button off
                    buttons [hover_index - 1].classList.replace ('btn', 'btn-hover')               // Turn prev button on
                }
            break;
        }
    }
    else if (uartjson ['action'] == 'scroll' && uartjson ['direction'] == 'down')
    {
        switch (BOARD_STATE) {
            case "PLAYERWAIT":
                if (hover_index == buttons.length - 1) {
                    buttons [hover_index].classList.replace ('btn-hover', 'btn')  // Turn last button off
                    buttons [0].classList.replace ('btn', 'btn-hover')                   // Turn first button on
                }
                else {
                    buttons [hover_index].classList.replace ('btn-hover', 'btn')     // Turn button off
                    buttons [hover_index + 1].classList.replace ('btn', 'btn-hover') // Turn next button on
                }
            break;
        }
    }
    else if (uartjson ['action'] == 'click')
    {
        switch (BOARD_STATE) {
            case "PLAYERWAIT":
                if ($("#btn_buy").classList().includes ('btn-hover')) {
                    stm32_write ("BUY")
                }
                else if ($("#btn_ignore").classList().includes ('btn-hover')) {
                    stm32_write ("IGN")
                }
                else if ($("#btn_trdbld").classList().includes ('btn-hover')) {
                    stm32_write ("TBC")  // Trade/build combined
                }
                else if ($("#btn_endturn").classList().includes ('btn-hover')) {
                    stm32_write ("EPT")  // End Player Turn
                }
            break;
        }
    }
}

function detectedDiceRoll () {
    BOARD_STATE = "DICEWAIT"
    $("#rolldie").attr ("src", "public/images/die.gif")
    $("#dialog1").html ("Dice roll detected!")
    $("#dialog2").html ("Waiting for roll...")
}

function handleDiceRoll (roll, nextpos, ccc_id) {
    BOARD_STATE = "DICERECV"
    $("#rolldie").attr ("src", "public/images/die.png")
    $("#dialog1").html ("Dice roll received!")
    $("#dialog2").html ("Roll was " + roll + "!")

    NEXT_POS = parseInt (nextpos)
    CCC_ID = ccc_id
}

function addPropertyToCurrentPlayer (card, player) {
    // Extract money
    player = parseInt (player)

    console.log (player)
    if (PLAYER_HOLDINGS [player].length == 0) {
        $('#cards_' + (player + 1).toString()).children()[0].remove()
    }
    PLAYER_HOLDINGS [player].push (card)
    
    newcardwhole = document.createElement ("div"); newcardwhole.classList.add ("card")
    newcardtop = document.createElement ("div"); newcardtop.classList.add ("cardtop")
    newcard = document.createElement ("div"); newcard.classList.add ("cardbot")
    newcardtop.style ['background-color'] = all_props [card].color || '#fff'

    newlabel = document.createElement ("label"); newlabel.classList.add ("cardtext")
    newlabel.innerHTML = all_props [card].displayname
    newcardtop.appendChild (newlabel) 

    newlabel = document.createElement ("label"); newlabel.classList.add ("cardtext")
    newlabel.innerHTML = "Price:          " + all_props [card].price
    newcard.appendChild (newlabel)

    if (property_ownable.includes (NEXT_POS) && !property_utility.includes (card)) {
        newlabel = document.createElement ("label"); newlabel.classList.add ("cardtext")
        newlabel.innerHTML = "Rent with no houses:           " + all_props [card].rent
        newcard.appendChild (newlabel)
    
        newlabel = document.createElement ("label"); newlabel.classList.add ("cardtext")
        newlabel.innerHTML = "Rent per house: " 
        newcard.appendChild (newlabel)
    
        newlabel = document.createElement ("label"); newlabel.classList.add ("cardtext")
        newlabel.innerHTML =   all_props [card].house1 + "/"
                             + all_props [card].house2 + "/"
                             + all_props [card].house3 + "/"
                             + all_props [card].house4
        newcard.appendChild (newlabel)
    
        newlabel = document.createElement ("label"); newlabel.classList.add ("cardtext")
        newlabel.innerHTML = "Rent with a hotel:   " + all_props [card].hotel
        newcard.appendChild (newlabel)
    
        newlabel = document.createElement ("label"); newlabel.classList.add ("cardtext")
        newlabel.innerHTML = "Mortgage:       " + all_props [card].mortgage
        newcard.appendChild (newlabel)
    
        newlabel = document.createElement ("label"); newlabel.classList.add ("cardtext")
        newlabel.innerHTML = "Cost per house: " + all_props [card].housecost
        newcard.appendChild (newlabel)

        newlabel = document.createElement ("label"); newlabel.classList.add ("cardtext")
        newlabel.innerHTML = "Cost of hotel:  " + all_props [card].posthotel
        newcard.appendChild (newlabel)
    }

    newcardwhole.appendChild (newcardtop)
    newcardwhole.appendChild (newcard)
    $('#cards_' + (player + 1).toString()).append (newcardwhole)
}

function landed_on_tile () {
    $("#diedialog").css ('display', 'none')
    $("#dialogccc").css ('display', 'none')
    $("#overlay").css ('opacity', '0')

    if (property_ownable.includes (NEXT_POS) && !property_utility.includes (NEXT_POS)) {
        $("#unowned_card_title").html (all_props [NEXT_POS].displayname)
        $(".dialogcardtop").css ('background-color',   all_props [NEXT_POS].color)
        $("#dialog_price").html  ("Price:          " + all_props [NEXT_POS].price)

        $("#dialog_rent").html   ("Rent:           " + all_props [NEXT_POS].rent)
        $("#dialog_h1").html     ("With 1 house:   " + all_props [NEXT_POS].house1)
        $("#dialog_h2").html     ("With 2 houses:  " + all_props [NEXT_POS].house2)
        $("#dialog_h2").css ('font-size', '')
        $("#dialog_h3").html     ("With 3 houses:  " + all_props [NEXT_POS].house3)
        $("#dialog_h4").html     ("With 4 houses:  " + all_props [NEXT_POS].house4)
        $("#dialog_hl").html     ("With a hotel:   " + all_props [NEXT_POS].hotel)
        $("#dialog_mort").html   ("Mortgage:       " + all_props [NEXT_POS].mortgage)
        $("#dialog_hc").html     ("Cost per house: " + all_props [NEXT_POS].housecost)
        $("#dialog_hotelc").html ("Cost of hotel:  " + all_props [NEXT_POS].posthotel)
        $("#dialogcard").css ('display', 'flex')
        $("#dialogccc").css ('display', 'none')
    }
    else if (property_utility.includes (NEXT_POS)) {
        $("#unowned_card_title").html (all_props [NEXT_POS].displayname)
        $(".dialogcardtop").css ('background-color',   "#fff")
        $(".dialogcardtop").css ('border-bottom', '1')
        $("#dialog_price").html  ("Price:          " + all_props [NEXT_POS].price)

        $("#dialog_rent").html ("Rent:           " + all_props [NEXT_POS].rent)
        $("#dialog_h1").html ("")
        $("#dialog_h2").html ("")
        $("#dialog_h2").css ('font-size', '')
        $("#dialog_h3").html ("")
        $("#dialog_h4").html ("")
        $("#dialog_hl").html ("")
        $("#dialog_mort").html ("Mortgage:       " + all_props [NEXT_POS].mortgage)
        $("#dialog_hc").html ("")
        $("#dialog_hotelc").html ("")
        $("#dialogcard").css ('display', 'flex')
        $("#dialogccc").css ('display', 'none')
    }
    else if (property_go == NEXT_POS) {
        $("#unowned_card_title").html ("Passing Go!")
        $(".dialogcardtop").css ('background-color', "#8fff9e")
        $(".dialogcardtop").css ('border', '')
        $("#dialog_price").html  ("")
        $("#dialog_rent").html ("")
        $("#dialog_h1").html ("")
        $("#dialog_h2").html ("Collect $200!")
        $("#dialog_h2").css ('font-size', '16px')
        $("#dialog_h3").html ("")
        $("#dialog_h4").html ("")
        $("#dialog_hl").html ("")
        $("#dialog_mort").html ("")
        $("#dialog_hc").html ("")
        $("#dialog_hotelc").html ("")
        $("#dialogcard").css ('display', 'flex')
        $("#dialogccc").css ('display', 'none')
    }
    else if (property_jail == NEXT_POS) {
        $("#unowned_card_title").html ("Passing through Jail!")
        $(".dialogcardtop").css ('background-color', "#ffc58f")
        $(".dialogcardtop").css ('border', '')
        $("#dialog_price").html  ("")
        $("#dialog_rent").html ("")
        $("#dialog_h1").html ("")
        $("#dialog_h2").html ("")
        $("#dialog_h2").css ('font-size', '16px')
        $("#dialog_h3").html ("")
        $("#dialog_h4").html ("")
        $("#dialog_hl").html ("")
        $("#dialog_mort").html ("")
        $("#dialog_hc").html ("")
        $("#dialog_hotelc").html ("")
        $("#dialogcard").css ('display', 'flex')
        $("#dialogccc").css ('display', 'none')
    }
    else if (property_gotojail == NEXT_POS) {
        $("#unowned_card_title").html ("Go to Jail!")
        $(".dialogcardtop").css ('background-color', "#ff8080")
        $(".dialogcardtop").css ('border', '')
        $("#dialog_price").html  ("")
        $("#dialog_rent").html ("")
        $("#dialog_h1").html ("")
        $("#dialog_h2").html ("Oh no, you've been arrested!")
        $("#dialog_h2").css ('font-size', '16px')
        $("#dialog_h3").html ("")
        $("#dialog_h4").html ("")
        $("#dialog_hl").html ("")
        $("#dialog_mort").html ("")
        $("#dialog_hc").html ("")
        $("#dialog_hotelc").html ("")
        $("#dialogcard").css ('display', 'flex')
        $("#dialogccc").css ('display', 'none')
    }
    else if (property_parking == NEXT_POS) {
        $("#unowned_card_title").html ("Free Parking!")
        $(".dialogcardtop").css ('background-color', "#8fff9e")
        $(".dialogcardtop").css ('border', '')
        $("#dialog_price").html  ("")
        $("#dialog_rent").html ("")
        $("#dialog_h1").html ("")
        $("#dialog_h2").html ("")
        $("#dialog_h2").css ('font-size', '')
        $("#dialog_h3").html ("")
        $("#dialog_h4").html ("")
        $("#dialog_hl").html ("")
        $("#dialog_mort").html ("")
        $("#dialog_hc").html ("")
        $("#dialog_hotelc").html ("")
        $("#dialogcard").css ('display', 'flex')
        $("#dialogccc").css ('display', 'none')
    }
    else if (property_taxes.includes (NEXT_POS)) {
        $("#unowned_card_title").html (all_props [NEXT_POS].displayname)
        $(".dialogcardtop").css ('background-color', "#8fff9e")
        $(".dialogcardtop").css ('border', '')
        $("#dialog_price").html  ("")
        $("#dialog_rent").html ("")
        $("#dialog_h1").html ("")
        $("#dialog_h2").html ("Pay a tax of " + all_props [NEXT_POS].tax + ".")
        $("#dialog_h2").css ('font-size', '16px')
        $("#dialog_h3").html ("")
        $("#dialog_h4").html ("")
        $("#dialog_hl").html ("")
        $("#dialog_mort").html ("")
        $("#dialog_hc").html ("")
        $("#dialog_hotelc").html ("")
        $("#dialogcard").css ('display', 'flex')
        $("#dialogccc").css ('display', 'none')
    }
    else if (property_community.includes (NEXT_POS) || property_chance.includes (NEXT_POS)) {
        $(".ccc-data").remove();

        ccc_label = document.createElement ("label")
        ccc_label.classList.add ('ccc-data')
        ccc_label.classList.add ('ccc-title')
        ccc_label.style ['background-color'] = "#bfebff"
        ccc_label.innerHTML = property_community.includes (NEXT_POS) ? 'Community Chest' : 'Chance'
        $("#dialogccc").append (ccc_label)

        ccc_label = document.createElement ("label")
        ccc_label.classList.add ('ccc-data')
        ccc_label.classList.add ('ccc-text')
        ccc_label.innerHTML = chance [CCC_ID]['description']
        $("#dialogcard").css ('display', 'none')
        $("#dialogccc").append (ccc_label)
        $("#dialogccc").css ('display', 'flex')
        CCC_ID = -1
    }

    $("#landed_unowned_dialog").css ('display', 'flex')
    setTimeout (function () { $("#overlay").css ('opacity', '1') }, 10)

    BOARD_STATE = "PLAYERWAIT"
}

// no need to receive which card to show - dice roll will determine that
// technically, game logic is still given by microcontroller
// Hence logic handling by the Pi will be pipelined alongside micro's own logic,
// so the micro doesn't... well... micromanage the Pi.